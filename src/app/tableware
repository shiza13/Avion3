// app/candle-holders/page.tsx (or your product detail page)
"use client";

import Image from "next/image";
import Link from "next/link";
import { FaTruckFast } from "react-icons/fa6";
import { LuCircleUser } from "react-icons/lu";
import { IoCartOutline } from "react-icons/io5";
import { HiOutlineHeart, HiHeart } from "react-icons/hi";
import { ShoppingCart, ArrowRight } from "lucide-react";
import React, { useEffect, useState } from "react";
import { client } from "../../../sanity/lib/client";
import { urlFor } from "../../../sanity/lib/image";
import { addToCart } from "../../../sanity/lib/cart";
import Swal from "sweetalert2";

export default function CandleHolders() {
  const [amount, setAmount] = useState(1);
  const [products, setProducts] = useState<any[]>([]);
  const [curatedSets, setCuratedSets] = useState<any[]>([]);
  const [wishlist, setWishlist] = useState<string[]>([]);

  const currentProductId = "candle-holders-set-001";

  useEffect(() => {
    const saved = localStorage.getItem("wishlist");
    if (saved) setWishlist(JSON.parse(saved));
  }, []);

  useEffect(() => {
    localStorage.setItem("wishlist", JSON.stringify(wishlist));
  }, [wishlist]);

  // Fetch regular products
  useEffect(() => {
    client.fetch(`*[_type == "product"]{ _id, name, price, image, slug }`).then(setProducts);
  }, []);

  // Fetch curated sets from Sanity
  useEffect(() => {
    client
      .fetch(`*[_type == "curatedSet"]{
        _id,
        title,
        description,
        products[]->{
          _id,
          name,
          price,
          image,
          slug
        }
      }`)
      .then((data) => setCuratedSets(data));
  }, []);

  const toggleWishlist = (id: string, name: string) => {
    if (wishlist.includes(id)) {
      setWishlist(prev => prev.filter(x => x !== id));
      Swal.fire({ icon: "info", title: "Removed", text: name, toast: true, position: "top-end", timer: 1500, showConfirmButton: false });
    } else {
      setWishlist(prev => [...prev, id]);
      Swal.fire({ icon: "success", title: "Added to Wishlist!", text: name, toast: true, position: "top-end", timer: 1800, showConfirmButton: false });
    }
  };

  const handleAddToCartFromGrid = (product: any) => {
    addToCart({
      _id: product._id,
      title: product.name,
      price: product.price,
      image: urlFor(product.image).url(),
      slug: product.slug.current,
    });
    Swal.fire({ icon: "success", title: "Added to Cart!", text: product.name, toast: true, position: "top-end", timer: 1500, showConfirmButton: false });
  };

  const handleAddToCart = () => {
    for (let i = 0; i < amount; i++) {
      addToCart({ _id: currentProductId, title: "The Candle Holders Set", price: 250, image: "/tableware1.PNG" });
    }
    Swal.fire({ icon: "success", title: "Added to Cart!", html: `<strong>${amount} × The Candle Holders Set</strong>`, toast: true, position: "top-end", timer: 2000, showConfirmButton: false });
    setAmount(1);
  };

  // Add entire set to cart
  const addSetToCart = (set: any) => {
    set.products.forEach((product: any) => {
      addToCart({
        _id: product._id,
        title: product.name,
        price: product.price,
        image: urlFor(product.image).url(),
        slug: product.slug.current,
      });
    });
    const total = set.products.reduce((sum: number, p: any) => sum + p.price, 0);
    Swal.fire({
      icon: "success",
      title: "Set Added!",
      html: `<strong>${set.title}</strong><br/>Rs ${total.toLocaleString()} added to cart!`,
      toast: true,
      position: "top-end",
      timer: 2500,
      showConfirmButton: false,
    });
  };

  return (
    <div className="bg-stone-50 min-h-screen">
      {/* Promo Bar */}
      <div className="bg-amber-900 text-white text-center py-3 text-sm font-medium relative">
        <div className="flex items-center justify-center gap-2">
          <FaTruckFast className="w-5 h-5" />
          Free Delivery on Orders Over Rs 5000
        </div>
        <button onClick={() => window.location.href = "/"} className="absolute right-6 top-3 text-2xl">×</button>
      </div>

      {/* Luxurious Navbar */}
      <nav className="bg-white shadow-sm">
        <div className="max-w-7xl mx-auto px-6 h-20 flex items-center justify-between">
          <Link href="/" className="text-4xl font-bold text-amber-900 tracking-wide">Avion</Link>
          <div className="hidden lg:flex items-center justify-center flex-1">
            <ul className="flex space-x-8 text-sm font-medium text-gray-700">
              <li><Link href="/products" className="hover:text-amber-900 transition">All Products</Link></li>
              <li><Link href="/plant-pots" className="hover:text-amber-900 transition">Plant Pots</Link></li>
              <li><Link href="/ceramics" className="hover:text-amber-900 transition">Ceramics</Link></li>
              <li><Link href="/tables" className="hover:text-amber-900 transition">Tables</Link></li>
              <li><Link href="/chairs" className="hover:text-amber-900 transition">Chairs</Link></li>
              <li><Link href="/crockery" className="hover:text-amber-900 transition">Crockery</Link></li>
              <li><Link href="/tableware" className="hover:text-amber-900 transition">Tableware</Link></li>
              <li><Link href="/cutlery" className="hover:text-amber-900 transition">Cutlery</Link></li>
            </ul>
          </div>
          <div className="flex items-center gap-7">
            <Link href="/wishlist" className="relative">
              <HiOutlineHeart className="w-7 h-7 hover:text-amber-900 transition" />
              {wishlist.length > 0 && (
                <span className="absolute -top-2 -right-2 bg-amber-900 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center font-bold">
                  {wishlist.length}
                </span>
              )}
            </Link>
            <Link href="/cart"><IoCartOutline className="w-7 h-7 hover:text-amber-900 transition" /></Link>
            <Link href="/profile"><LuCircleUser className="w-7 h-7 hover:text-amber-900 transition" /></Link>
          </div>
        </div>
      </nav>

      {/* Product Detail */}
      <div className="max-w-7xl mx-auto px-6 py-20 grid lg:grid-cols-2 gap-16">
        <div className="rounded-3xl overflow-hidden shadow-2xl">
          <Image src="/tableware1.PNG" alt="The Candle Holders Set" width={800} height={800} className="w-full h-full object-cover hover:scale-105 transition duration-700" />
        </div>
        <div className="flex flex-col justify-center">
          <h1 className="text-5xl font-bold text-gray-900 mb-4">The Candle Holders Set</h1>
          <p className="text-4xl text-amber-900 font-medium mb-8">Rs 250</p>
          <p className="text-gray-600 text-lg leading-relaxed mb-10">
            A stunning set of three pillar candle holders featuring a rich midnight blue finish and elegant metallic accents...
          </p>
          <div className="flex items-center gap-8 mb-12">
            <div className="flex items-center border border-gray-300 rounded-xl">
              <button onClick={() => setAmount(a => Math.max(1, a-1))} className="px-6 py-4 hover:bg-gray-100">-</button>
              <span className="px-10 py-4 font-bold text-xl">{amount}</span>
              <button onClick={() => setAmount(a => a + 1)} className="px-6 py-4 hover:bg-gray-100">+</button>
            </div>
            <button onClick={handleAddToCart} className="bg-amber-900 text-white px-12 py-5 rounded-xl font-semibold hover:bg-amber-800 transition text-lg">
              Add to Cart
            </button>
          </div>
        </div>
      </div>

      {/* You might also like */}
      <section className="py-24 bg-white">
        <div className="max-w-7xl mx-auto px-6">
          <h2 className="text-4xl font-medium text-center mb-16 text-gray-800">You might also like</h2>
          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-10">
            {products.slice(4, 8).map((product) => {
              const isWishlisted = wishlist.includes(product._id);
              return (
                <div key={product._id} className="group">
                  <Link href={`/products/${product.slug.current}`}>
                    <div className="relative overflow-hidden rounded-3xl bg-white shadow-lg hover:shadow-2xl transition-all duration-500 hover:-translate-y-3">
                      <Image src={urlFor(product.image).url()} alt={product.name} width={400} height={400} className="w-full h-96 object-cover group-hover:scale-110 transition-transform duration-700" />
                      <div className="absolute inset-0 bg-black/30 opacity-0 group-hover:opacity-100 transition-opacity duration-500 flex items-center justify-center">
                        <div className="flex gap-5">
                          <button onClick={(e) => { e.preventDefault(); toggleWishlist(product._id, product.name); }} className="p-4 bg-white rounded-full shadow-xl hover:scale-110 transition">
                            {isWishlisted ? <HiHeart className="w-7 h-7 text-amber-900" /> : <HiOutlineHeart className="w-7 h-7 text-gray-800" />}
                          </button>
                          <button onClick={(e) => { e.preventDefault(); handleAddToCartFromGrid(product); }} className="p-4 bg-white rounded-full shadow-xl hover:scale-110 transition">
                            <ShoppingCart className="w-7 h-7 text-amber-900" />
                          </button>
                        </div>
                      </div>
                    </div>
                    <div className="mt-6 text-left">
                      <h3 className="text-xl font-semibold text-gray-900">{product.name}</h3>
                      <p className="text-lg text-amber-900 font-medium mt-1">Rs {product.price.toLocaleString()}</p>
                    </div>
                  </Link>
                </div>
              );
            })}
          </div>

          <div className="text-center mt-20">
            <Link href="/products">
              <button className="px-10 py-4 bg-white border-2 border-amber-900 text-amber-900 rounded-full font-semibold hover:bg-amber-50 transition text-lg">
                View Full Collection
              </button>
            </Link>
          </div>
        </div>
      </section>

      {/* COMPLETE THE LOOK – CONNECTED TO SANITY & SUPER INTERESTING */}
      <section className="py-24 bg-gradient-to-b from-white to-stone-100">
        <div className="max-w-7xl mx-auto px-6">
          <div className="text-center mb-16">
            <h2 className="text-5xl font-bold text-gray-900 mb-4">Complete the Look</h2>
            <p className="text-xl text-gray-600">Curated collections to instantly elevate your space</p>
          </div>

          <div className="overflow-x-auto scrollbar-hide pb-8">
            <div className="flex gap-10">
              {curatedSets.map((set) => {
                const totalPrice = set.products.reduce((sum: number, p: any) => sum + p.price, 0);
                return (
                  <div key={set._id} className="min-w-[620px] bg-white rounded-3xl shadow-xl overflow-hidden hover:shadow-2xl transition-all duration-300">
                    <div className="grid grid-cols-2">
                      <div className="p-10 bg-gradient-to-br from-amber-50 to-orange-50 flex items-center justify-center">
                        <div className="grid grid-cols-2 gap-4">
                          {set.products.slice(0, 3).map((p: any, i: number) => (
                            <Image
                              key={i}
                              src={urlFor(p.image).url()}
                              alt={p.name}
                              width={180}
                              height={180}
                              className="rounded-2xl shadow-md hover:scale-105 transition"
                            />
                          ))}
                        </div>
                      </div>
                      <div className="p-12 flex flex-col justify-center">
                        <h3 className="text-3xl font-bold text-gray-900 mb-3">{set.title}</h3>
                        <p className="text-gray-600 mb-8 text-lg">{set.description}</p>
                        <div className="flex items-center justify-between">
                          <p className="text-4xl font-bold text-amber-900">Rs {totalPrice.toLocaleString()}</p>
                          <button
                            onClick={() => addSetToCart(set)}
                            className="bg-amber-900 text-white px-10 py-5 rounded-full hover:bg-amber-800 transition flex items-center gap-3 text-lg font-medium"
                          >
                            Shop Set <ArrowRight className="w-6 h-6" />
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                );
              })}
            </div>
          </div>
        </div>
      </section>
      

      {/* Elegant Footer */}
      <footer className="bg-amber-950 text-white py-16 text-center">
        <p className="text-xl">© 2025 Avion LTD • Timeless Home Decor for Modern Living</p>
      </footer>
    </div>
  );
}


// app/candle-holders/page.tsx
// "use client";

// import Image from "next/image";
// import Link from "next/link";
// import { FaTruckFast } from "react-icons/fa6";
// import { LuCircleUser } from "react-icons/lu";
// import { IoCartOutline } from "react-icons/io5";
// import { HiOutlineHeart, HiHeart } from "react-icons/hi";
// import { ShoppingCart, ArrowRight, Star, ShieldCheck } from "lucide-react";
// import React, { useEffect, useState } from "react";
// import { client } from "../../../sanity/lib/client";
// import { urlFor } from "../../../sanity/lib/image";
// import { addToCart } from "../../../sanity/lib/cart";
// import Swal from "sweetalert2";

// export default function CandleHolders() {
//   const [amount, setAmount] = useState(1);
//   const [products, setProducts] = useState<any[]>([]);
//   const [curatedSets, setCuratedSets] = useState<any[]>([]);
//   const [reviews, setReviews] = useState<any[]>([]);
//   const [wishlist, setWishlist] = useState<string[]>([]);
//   const [showReviewForm, setShowReviewForm] = useState(false);
//   const [reviewName, setReviewName] = useState("");
//   const [reviewRating, setReviewRating] = useState(5);
//   const [reviewComment, setReviewComment] = useState("");
//   const [isSubmitting, setIsSubmitting] = useState(false);

//   const currentProductRef = "candle-holders-set-001"; // ← Change if your product has a different _id

//   // Wishlist persistence
//   useEffect(() => {
//     const saved = localStorage.getItem("wishlist");
//     if (saved) setWishlist(JSON.parse(saved));
//   }, []);
//   useEffect(() => localStorage.setItem("wishlist", JSON.stringify(wishlist)), [wishlist]);

//   // Fetch products & curated sets
//   useEffect(() => {
//     client.fetch(`*[_type == "product"]{ _id, name, price, image, slug }`).then(setProducts);
//   }, []);
//   useEffect(() => {
//     client.fetch(`*[_type == "curatedSet"]{ _id, title, description, products[]->{ _id, name, price, image, slug } }`)
//       .then(data => setCuratedSets(data));
//   }, []);

//   // ────────────────────────────────
//   // FETCH + REFRESH REVIEWS
//   // ────────────────────────────────
//   const fetchReviews = async () => {
//     const data = await client.fetch(
//       `*[_type == "review" && product->_id == $productId] | order(createdAt desc) {
//         _id, name, rating, comment, verified, createdAt
//       }`,
//       { productId: currentProductRef }
//     );

//     if (data.length === 0) {
//       // fallback reviews (only when nothing in Sanity)
//       setReviews([
//         { _id: "f1", name: "Priya Sharma", rating: 5, comment: "Stunning! My dining table looks like a luxury hotel now.", verified: true, createdAt: new Date().toISOString() },
//         { _id: "f2", name: "Rohan Malhotra", rating: 5, comment: "Perfect quality and fast delivery. Highly recommend!", verified: true, createdAt: new Date().toISOString() },
//         { _id: "f3", name: "Ananya Desai", rating: 4, comment: "Beautiful design. Adds warmth to any room.", verified: true, createdAt: new Date().toISOString() },
//       ]);
//     } else {
//       setReviews(data);
//     }
//   };

//   useEffect(() => {
//     fetchReviews();
//   }, []);

//   // ────────────────────────────────
//   // SUBMIT REVIEW (adds to Sanity + updates UI instantly)
//   // ────────────────────────────────
//   const submitReview = async () => {
//     if (!reviewName.trim() || !reviewComment.trim()) {
//       Swal.fire({ icon: "error", title: "Please fill all fields", toast: true, position: "top-end", timer: 2000 });
//       return;
//     }

//     setIsSubmitting(true);

//     const newReview = {
//       _type: "review",
//       name: reviewName.trim(),
//       rating: reviewRating,
//       comment: reviewComment.trim(),
//       verified: true,
//       product: { _type: "reference", _ref: currentProductRef },
//       createdAt: new Date().toISOString(),
//     };

//     try {
//       const created = await client.create(newReview);

//       // Optimistically add to UI
//       setReviews(prev => [created, ...prev]);

//       Swal.fire({
//         icon: "success",
//         title: "Thank you!",
//         text: "Your review has been added!",
//         toast: true,
//         position: "top-end",
//         timer: 2000,
//       });

//       // Reset form
//       setReviewName("");
//       setReviewComment("");
//       setReviewRating(5);
//       setShowReviewForm(false);
//     } catch (err) {
//       console.error(err);
//       Swal.fire({ icon: "error", title: "Something went wrong", toast: true, position: "top-end", timer: 2000 });
//     } finally {
//       setIsSubmitting(false);
//     }
//   };

//   // ────────────────────────────────
//   // Helper components
//   // ────────────────────────────────
//   const StarRating = ({ rating, interactive = false, onChange }: { rating: number; interactive?: boolean; onChange?: (r: number) => void }) => (
//     <div className="flex gap-1">
//       {[1, 2, 3, 4, 5].map((i) => (
//         <Star
//           key={i}
//           className={`w-6 h-6 transition ${i <= rating ? "fill-amber-500 text-amber-500" : "text-gray-300"} ${interactive ? "cursor-pointer hover:fill-amber-400" : ""}`}
//           onClick={() => interactive && onChange?.(i)}
//         />
//       ))}
//     </div>
//   );

//   // ────────────────────────────────
//   // Cart & Wishlist functions (unchanged)
//   // ────────────────────────────────
//   const toggleWishlist = (id: string, name: string) => { /* same as before */ };
//   const handleAddToCartFromGrid = (product: any) => { /* same */ };
//   const handleAddToCart = () => { /* same */ };
//   const addSetToCart = (set: any) => { /* same */ };

//   return (
//     <div className="bg-stone-50 min-h-screen">
//       {/* ──────── YOUR EXISTING SECTIONS (Promo, Navbar, Hero, You might also like, Complete the Look) ──────── */}
//       {/* (keep everything you already have here – I'm only showing the new part below) */}

//       {/* ─────────────────────── CUSTOMER REVIEWS SECTION ─────────────────────── */}
//       <section className="py-24 bg-white">
//         <div className="max-w-7xl mx-auto px-6">
//           <div className="text-center mb-16">
//             <h2 className="text-5xl font-bold text-gray-900 mb-4">Customer Reviews</h2>
//             <div className="flex items-center justify-center gap-4">
//               <StarRating rating={4.8} />
//               <span className="text-2xl font-bold text-amber-900">4.8 / 5</span>
//               <span className="text-gray-600">({reviews.length} reviews)</span>
//             </div>
//           </div>

//           {/* Reviews Grid */}
//           <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mb-16">
//             {reviews.slice(0, 6).map((review) => (
//               <div key={review._id} className="bg-gradient-to-b from-amber-50 to-white rounded-3xl p-8 shadow-lg hover:shadow-2xl transition">
//                 <div className="flex items-center gap-4 mb-4">
//                   <div className="w-14 h-14 bg-amber-200 rounded-full flex items-center justify-center text-2xl font-bold text-amber-900">
//                     {review.name.charAt(0).toUpperCase()}
//                   </div>
//                   <div>
//                     <h4 className="font-bold text-gray-900">{review.name}</h4>
//                     {review.verified && (
//                       <div className="flex items-center gap-1 text-emerald-600 text-sm">
//                         <ShieldCheck className="w-4 h-4" /> Verified Buyer
//                       </div>
//                     )}
//                   </div>
//                 </div>

//                 <StarRating rating={review.rating} />

//                 <p className="mt-4 text-gray-700 leading-relaxed">{review.comment}</p>

//                 <p className="text-sm text-gray-500 mt-4">
//                   {new Date(review.createdAt).toLocaleDateString("en-IN", {
//                     day: "numeric",
//                     month: "short",
//                     year: "numeric",
//                   })}
//                 </p>
//               </div>
//             ))}
//           </div>

//           {/* Write a Review Button */}
//           <div className="text-center">
//             <button
//               onClick={() => setShowReviewForm(!showReviewForm)}
//               className="bg-amber-900 text-white px-10 py-4 rounded-full font-semibold hover:bg-amber-800 transition text-lg"
//             >
//               {showReviewForm ? "Cancel" : "Write a Review"}
//             </button>
//           </div>

//           {/* Review Form */}
//           {showReviewForm && (
//             <div className="mt-16 bg-gradient-to-r from-amber-50 to-orange-50 rounded-3xl p-10 max-w-3xl mx-auto">
//               <h3 className="text-3xl font-bold text-center mb-8">Share Your Experience</h3>

//               <div className="space-y-6">
//                 <input
//                   type="text"
//                   placeholder="Your Name"
//                   value={reviewName}
//                   onChange={(e) => setReviewName(e.target.value)}
//                   className="w-full px-6 py-4 rounded-xl border border-gray-300 focus:outline-none focus:border-amber-900"
//                   required
//                 />

//                 <div className="text-center">
//                   <p className="text-lg mb-3">Rate this product:</p>
//                   <StarRating rating={reviewRating} interactive onChange={setReviewRating} />
//                 </div>

//                 <textarea
//                   placeholder="Write your review..."
//                   value={reviewComment}
//                   onChange={(e) => setReviewComment(e.target.value)}
//                   rows={5}
//                   className="w-full px-6 py-4 rounded-xl border border-gray-300 focus:outline-none focus:border-amber-900 resize-none"
//                   required
//                 />

//                 <div className="text-center">
//                   <button
//                     onClick={submitReview}
//                     disabled={isSubmitting}
//                     className="bg-amber-900 text-white px-12 py-4 rounded-full font-bold hover:bg-amber-800 transition text-lg disabled:opacity-70"
//                   >
//                     {isSubmitting ? "Submitting..." : "Submit Review"}
//                   </button>
//                 </div>
//               </div>
//             </div>
//           )}
//         </div>
//       </section>

//       {/* Footer */}
//       <footer className="bg-amber-950 text-white py-16 text-center">
//         <p className="text-xl">© 2025 Avion LTD • Timeless Home Decor for Modern Living</p>
//       </footer>
//     </div>
//   );
// }
